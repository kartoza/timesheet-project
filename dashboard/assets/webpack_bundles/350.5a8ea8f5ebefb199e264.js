"use strict";(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[350],{350:(e,t,n)=>{n.r(t),n.d(t,{TimeCard:()=>B,default:()=>$});var i=n(74848),r=n(33551),a=n(1043),s=n(78717),o=n(51841),l=n(56239),c=n(56826),u=n(75737),d=n(63342),f=n(46299),m=n(99941),p=n(97981),h=n(95093),v=n.n(h),g=n(96540),x=n(63661),j=n(51125),b=n(42571),y=n(82876),A=n(62430),w=n(22279),T=n(93357),S=n(85072),k=n.n(S),D=n(97825),_=n.n(D),z=n(77659),C=n.n(z),E=n(55056),Y=n.n(E),H=n(10540),M=n.n(H),F=n(41113),I=n.n(F),O=n(76465),L={};L.styleTagTransform=I(),L.setAttributes=Y(),L.insert=C().bind(null,"head"),L.domAPI=_(),L.insertStyleElement=M(),k()(O.A,L),O.A&&O.A.locals&&O.A.locals;var N=function(){return N=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},N.apply(this,arguments)};function U(e){var t=(0,g.useState)("00"),n=t[0],r=t[1],a=(0,g.useState)("00"),s=a[0],o=a[1],l=(0,g.useState)("00"),c=l[0],u=l[1],d=(0,g.useState)(""),f=d[0],m=d[1];return(0,g.useEffect)((function(){if(e.runningTime!==f){var t=e.runningTime.split(":");r(t[0]),o(t[1]),u(t[2]),m(e.runningTime)}}),[e.runningTime,f]),(0,g.useEffect)((function(){var t=""+[n,s,c].join(":");t!==e.runningTime&&(e.onChange(t),m(t))}),[n,s,c,f,e.runningTime]),(0,i.jsxs)("div",N({style:{display:"flex"}},{children:[(0,i.jsx)("input",{type:"text",disabled:e.disabled,value:n,pattern:"[0-9]",maxLength:2,onChange:function(e){var t=e.target.value;""!==t?/^\d{0,2}$/.test(t)&&r(t):r("00")},className:"numberBox"}),(0,i.jsx)("div",N({className:"timeSeparator"},{children:":"})),(0,i.jsx)("input",{type:"text",value:s,disabled:e.disabled,pattern:"[0-9]",maxLength:2,onChange:function(e){var t=e.target.value;if(""!==t){if(/^\d{0,2}$/.test(t)){if(parseInt(t)>=60)return void o("59");o(t)}}else o("00")},className:"numberBox"}),(0,i.jsx)("div",N({className:"timeSeparator"},{children:":"})),(0,i.jsx)("input",{type:"text",value:c,disabled:e.disabled,pattern:"[0-9]",maxLength:2,onChange:function(e){var t=e.target.value;if(""!==t){if(/^\d{0,2}$/.test(t)){if(parseInt(t)>=60)return void u("59");u(t)}}else u("00")},className:"numberBox"})]}))}var R=function(){return R=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},R.apply(this,arguments)},P=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},Z=function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},B=(0,g.forwardRef)((function(e,t){var n=e.runningTimeLog,h=e.pausedTimeLog,S=e.editingTimeLog,k=e.toggleTimer,D=e.task,_=e.project,z=e.activity,C=e.description,E=e.parent,Y=e.isUnavailable,H=e.clearAllFields,M=e.initialAccumulatedTimeMs,F=void 0===M?0:M,I=g.useState(new Date),O=I[0],L=I[1],N=g.useState(null),B=N[0],$=N[1],q=g.useState(null),W=q[0],G=q[1],J=g.useState(""),K=J[0],Q=J[1],V=g.useState(!0),X=V[0],ee=V[1],te=g.useState(!0),ne=te[0],ie=te[1],re=(0,g.useState)(!1),ae=re[0],se=re[1],oe=(0,g.useState)("00:00:00"),le=oe[0],ce=oe[1],ue=(0,g.useState)(null),de=ue[0],fe=ue[1],me=(0,g.useState)(null),pe=me[0],he=me[1],ve=(0,g.useState)(null),ge=ve[0],xe=ve[1],je=g.useState(!1),be=je[0],ye=je[1],Ae=(0,g.useState)(0),we=Ae[0],Te=Ae[1],Se=(0,g.useState)(""),ke=Se[0],De=Se[1],_e=(0,x.AC)(),ze=_e[0],Ce=_e[1],Ee=Ce.isLoading,Ye=Ce.isSuccess,He=Ce.isError,Me=Ce.error,Fe=Ce.data,Ie=(0,x.c3)(),Oe=Ie[0],Le=Ie[1],Ne=Le.isLoading,Ue=Le.isSuccess,Re=(Le.isError,Le.data),Pe=(0,x.We)(),Ze=Pe[0],Be=Pe[1],$e=(Be.isLoading,Be.isSuccess,Be.isError,(0,x.B)()),qe=$e[0],We=$e[1].isLoading,Ge=(0,g.useState)(null),Je=Ge[0],Ke=Ge[1],Qe=(0,g.useState)(0),Ve=Qe[0],Xe=Qe[1],et=(0,g.useRef)("00:00:00"),tt=(0,g.useRef)(null);(0,g.useEffect)((function(){he(Re)}),[Re]),(0,g.useEffect)((function(){xe(Fe)}),[Fe]),(0,g.useEffect)((function(){ee(null==O||null==W||!z),ie(!z)}),[O,W,D,z,C]),(0,g.useEffect)((function(){if(be&&!B&&W){var e=new Date(O.getTime());e.setHours(e.getHours()+parseFloat(W)),$(e)}}),[be]);var nt=(0,g.useCallback)((function(e){void 0===e&&(e=!0),G(null),Q(""),H(e),he(null),xe(null)}),[H]);(0,g.useEffect)((function(){Ye&&ge&&(ge.running?(k(!0),fe(ge),Ke(null)):(fe(null),B&&L(B),nt(!1)))}),[Ye,ge]),(0,g.useEffect)((function(){(de||S)&&pe&&!pe.running&&(k(!1),clearInterval(tt.current),tt.current=null,ie(!0),ce("00:00:00"),Xe(0),fe(null),nt())}),[de,S,Ue,pe]),(0,g.useEffect)((function(){if(S){G(S.hours),Q(S.hours);var e=v()(S.from_time,"YYYY-MM-DD hh:mm:ss").toDate();L(e);var t=new Date(e.getTime());t.setHours(t.getHours()+S.hours),$(t)}}),[S]),(0,g.useEffect)((function(){n&&fe(n)}),[n]),(0,g.useEffect)((function(){F>0&&Xe(F)}),[F]),(0,g.useEffect)((function(){if(h&&!Je&&!de)if(Ke(h),h.all_hours){var e=3600*parseFloat(h.all_hours)*1e3;Xe(e),ce(v().utc(e).format("HH:mm:ss"))}else if(h.from_time&&h.to_time){var t=v()(h.from_time,"YYYY-MM-DD HH:mm:ss"),n=v()(h.to_time,"YYYY-MM-DD HH:mm:ss").diff(t);ce(v().utc(n).format("HH:mm:ss"))}}),[h]);var it=(0,g.useCallback)((function(){if(de){var e=v()(de.from_time,"YYYY-MM-DD hh:mm:ss"),t=v()().diff(e)+Ve,n=v().utc(t).format("HH:mm:ss");ce(n),et.current=n}}),[de,Ve]);(0,g.useEffect)((function(){if(de){ie(!1),it(),tt.current=setInterval(it,1e3);var e=document.querySelector("link[rel~='icon']");e&&(e.href="/static/running-favicon.ico")}return function(){tt.current&&(clearInterval(tt.current),tt.current=null)}}),[de,it]);var rt=function(){L(v()().toDate())},at=function(e){G(e.hours),Q(e.hours);var t=v()(e.from_time,"YYYY-MM-DD hh:mm:ss").toDate();L(t)};(0,g.useImperativeHandle)(t,(function(){return{startButtonClicked:lt,updateHours:at,resetStartTime:rt}}));var st=(0,g.useCallback)((function(){var e=null;if(ee(!0),null!=W&&O){var t=new Date(O.toISOString());e=W>0?(0,j.LY)(W,t):t}if(e&&O&&z){var n=D?D.id:"-",i="function"==typeof O.toDate?O.toDate():O,r=(0,j.fU)(i),a=(0,j.fU)(e),s=Intl.DateTimeFormat().resolvedOptions().timeZone;ze({start_time:r,end_time:a,task:{id:n},activity:{id:z.id},project:{id:_?_.id:""},description:C,timezone:s})}}),[ze,W,O,z,D,_,C]),ot=(0,g.useCallback)((function(e){if(void 0===e&&(e=!1),se(!1),ie(!0),clearInterval(tt.current),tt.current=null,O&&z){var t=D?D.id:"-",n=Intl.DateTimeFormat().resolvedOptions().timeZone,i=le;e&&(i="00:00:00");var r=(0,j.fU)(new Date);if("00:00:00"!==i){var a=i.split(":").map(Number),s=1e3*(60*a[0]*60+60*a[1]+a[2]),o=new Date((new Date).getTime()-s);r=(0,j.fU)(o)}ze({start_time:r,task:{id:t},activity:{id:z.id},project:{id:_?_.id:""},description:C,timezone:n,parent:E})}}),[ze,O,z,D,le,_,C,E]),lt=function(e){void 0===e&&(e=!1),Te(0),De("start"),ot(e)};(0,g.useEffect)((function(){if(He){if(we<3){var e=setTimeout((function(){"submit"===ke?(ee(!0),st()):"start"===ke&&(ie(!0),ot(!1)),Te((function(e){return e+1}))}),1e3);return function(){return clearTimeout(e)}}ie(!1),ee(!1),alert("Failed to add timesheet, please try again later.")}}),[He,we,ke,Me]);var ct=function(e,t){if(e&&t){[e,t].forEach((function(e){var t=e.getMinutes();e.getSeconds()>=30&&e.setMinutes(t+1),e.setSeconds(0,0)}));var n=(t.getTime()-e.getTime())/36e5;(n=parseFloat(n.toFixed(2)))>0?(G(n),Q(n+"")):(G(null),Q(""))}};return(0,i.jsxs)(u.$,R({dateAdapter:m.h},{children:[ae||S?(0,i.jsxs)("div",{children:[(0,i.jsxs)(l.A,R({sx:{paddingLeft:0,paddingRight:0,paddingTop:0}},{children:[(0,i.jsxs)(o.A,R({container:!0,spacing:.6},{children:[(0,i.jsx)(o.A,R({size:7,className:"time-picker"},{children:(0,i.jsx)(d.l,{value:O,onChange:function(e){return L(e)},format:"dd/MM/yyyy",className:"date-picker-input"})})),(0,i.jsx)(o.A,R({size:1,style:{marginTop:15}},{children:(0,i.jsx)(r.A,R({color:"text.primary"},{children:":"}))})),(0,i.jsx)(o.A,R({size:4,className:"time-picker"},{children:(0,i.jsx)(f.A,{ampm:!1,value:O,onChange:function(e){L(e),ct(e,B)},viewRenderers:{hours:p.Zo,minutes:p.Zo,seconds:p.Zo}})}))]})),(0,i.jsxs)(o.A,R({container:!0,spacing:.6},{children:[(0,i.jsx)(o.A,R({size:10},{children:be?(0,i.jsx)("div",R({style:{marginLeft:"-20px"}},{children:(0,i.jsx)(f.A,{ampm:!1,value:B,onChange:function(e){$(e),ct(O,e)},viewRenderers:{hours:p.Zo,minutes:p.Zo,seconds:p.Zo}})})):(0,i.jsx)(a.A,{error:K.length>4&&!W,value:K,id:"hour",onChange:function(e){var t=e.target.value;if(G(null),Q(t),t){var n=O;v().isMoment(O)&&(n=n.toDate(),L(n));var i=new Date(n.getTime());if(!isNaN(t)){var r=parseFloat(t);G(r);var a=60*(r-Math.floor(r));return i.setHours(i.getHours()+r),i.setMinutes(i.getMinutes()+a),void $(i)}var s=t.match(/(0?[0-9]|1[0-2])(:|.)[0-9]{2}/g);if(s&&s.length>0){var o=s[0];if(r=0,o.includes(":")){var l=o.split(":")[1],c=o.split(":")[0];r=parseFloat((parseFloat(c)+parseFloat(l)/60).toFixed(2))}else r=parseFloat(o);G(r),a=60*(r-Math.floor(r)),i.setHours(i.getHours()+r),i.setMinutes(i.getMinutes()+a),$(i)}}},type:"text",helperText:"HH:MM or decimal",InputProps:{inputProps:{min:0}},label:"Hours",variant:"standard",sx:{width:"100%"}})})),(0,i.jsx)(o.A,R({size:2},{children:(0,i.jsx)(b.A,R({variant:"text",onClick:function(){return ye(!be)},style:{minWidth:0,paddingLeft:4,paddingRight:4,marginTop:12}},{children:(0,i.jsx)(A.A,{})}))}))]}))]})),(0,i.jsx)(c.A,R({sx:{justifyContent:"center",padding:0,marginBottom:"10px",marginTop:"4px"}},{children:S?(0,i.jsxs)("div",R({style:{width:"100%"}},{children:[(0,i.jsx)(b.A,R({color:"warning",variant:"contained",size:"small",sx:{width:"50%",marginTop:-1},onClick:function(){nt()},disabled:Ne||Y,disableElevation:!0},{children:"Cancel"})),(0,i.jsx)(b.A,R({color:"success",variant:"contained",size:"small",sx:{width:"50%",marginTop:-1},onClick:function(){var e=null;if(null!=W&&O){var t=new Date(O.toISOString());e=(0,j.LY)(W,t)}if(S&&O&&e&&z&&S){var n=Object.assign({},S),i="";D&&(i=D.id),i||(i="-"),n.task={id:i},n.activity={id:z.id},n.project={id:_?_.id:""},n.description=C,n.end_time=(0,j.fU)(e);var r=O;"function"==typeof O.toDate&&(r=O.toDate()),n.start_time=(0,j.fU)(r),n.editing=!0,Oe(n)}},disabled:X||Ne||Y,disableElevation:!0},{children:Ne?(0,i.jsx)(s.A,{color:"inherit",size:20}):"Save"}))]})):(0,i.jsx)(b.A,R({variant:"contained",size:"small",sx:{width:"100%",marginTop:-1},onClick:function(){Te(0),De("submit"),st()},disabled:X||Ee||Y,disableElevation:!0},{children:Ee?(0,i.jsx)(s.A,{color:"inherit",size:20}):"Add"}))}))]}):(0,i.jsxs)("div",R({style:{marginTop:"8px",marginBottom:"0.5em"}},{children:[(0,i.jsx)(U,{disabled:de||Je,runningTime:le,onChange:function(e){return ce(e)}}),(0,i.jsx)(l.A,R({sx:{paddingLeft:0,paddingRight:0}},{children:de?(0,i.jsxs)(o.A,R({container:!0,spacing:1},{children:[(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({color:"warning",variant:"contained",size:"small",sx:{width:"100%",height:"58px",marginTop:-1},onClick:function(){return P(void 0,void 0,void 0,(function(){var e,t,n,i,r,a,s,o;return Z(this,(function(l){switch(l.label){case 0:if(!de)return[2];e=et.current,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,qe({id:de.id}).unwrap()];case 2:return t=l.sent(),Ke(t),fe(null),clearInterval(tt.current),tt.current=null,n=e.split(":").map(Number),i=n[0],r=n[1],a=n[2],Xe(1e3*(60*i*60+60*r+a)),(s=document.querySelector("link[rel~='icon']"))&&(s.href="/static/timesheet-logo.png"),[3,4];case 3:return o=l.sent(),console.error("Failed to pause timesheet:",o),[3,4];case 4:return[2]}}))}))},disabled:We,disableElevation:!0},{children:We?(0,i.jsx)(s.A,{color:"inherit",size:20}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.A,{sx:{mr:.5}})," PAUSE"]})}))})),(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({color:"info",variant:"contained",size:"small",sx:{width:"100%",height:"58px",marginTop:-1},onClick:function(){return P(void 0,void 0,void 0,(function(){var e,t,n;return Z(this,(function(i){return de?(clearInterval(tt.current),tt.current=null,(e=document.querySelector("link[rel~='icon']"))&&(e.href="/static/timesheet-logo.png"),t=Object.assign({},de),n=D?D.id:"-",t.task={id:n},t.activity={id:z?z.id:de.activity_id},t.project={id:_?_.id:de.project_id||""},t.description=C||de.description,t.end_time=(0,j.fU)(new Date),Oe(t),[2]):[2]}))}))},disabled:Ne,disableElevation:!0},{children:Ne?(0,i.jsx)(s.A,{color:"inherit",size:20}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.A,{sx:{mr:.5}})," STOP"]})}))}))]})):Je?(0,i.jsxs)(o.A,R({container:!0,spacing:1},{children:[(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({color:"success",variant:"contained",size:"small",sx:{width:"100%",height:"58px",marginTop:-1},onClick:function(){if(Je){if(Je.from_time&&Je.to_time){var e=v()(Je.from_time,"YYYY-MM-DD HH:mm:ss"),t=v()(Je.to_time,"YYYY-MM-DD HH:mm:ss").diff(e),n=Je.all_hours?3600*parseFloat(Je.all_hours)*1e3:t;Xe(n)}var i=Intl.DateTimeFormat().resolvedOptions().timeZone,r=(0,j.fU)(new Date);ze({start_time:r,task:{id:Je.task_id||"-"},activity:{id:Je.activity_id},project:{id:Je.project_id||""},description:Je.description,timezone:i,parent:Je.id}),Ke(null)}},disabled:Ee||Y,disableElevation:!0},{children:Ee?(0,i.jsx)(s.A,{color:"inherit",size:20}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.g0,{sx:{mr:.5}})," RESUME"]})}))})),(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({color:"info",variant:"contained",size:"small",sx:{width:"100%",height:"58px",marginTop:-1},onClick:function(){return P(void 0,void 0,void 0,(function(){var e,t;return Z(this,(function(n){switch(n.label){case 0:if(!Je)return[3,4];e={id:Je.id,task:{id:Je.task_id||"-"},activity:{id:Je.activity_id},project:{id:Je.project_id||""},description:Je.description||"",start_time:Je.from_time,end_time:Je.to_time,is_paused:!1,editing:!0},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Oe(e).unwrap()];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),console.error("Failed to clear paused state:",t),[3,4];case 4:return Ke(null),ce("00:00:00"),Xe(0),nt(),k(!1),[2]}}))}))},disabled:Ne,disableElevation:!0},{children:Ne?(0,i.jsx)(s.A,{color:"inherit",size:20}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.A,{sx:{mr:.5}})," STOP"]})}))}))]})):(0,i.jsx)(b.A,R({color:"success",variant:"contained",size:"small",sx:{width:"100%",height:"58px",marginTop:-1},onClick:function(){return lt(!1)},disabled:ne||Y,disableElevation:!0},{children:Ee?(0,i.jsx)(s.A,{color:"inherit",size:20}):"START"}))}))]})),(0,i.jsx)("div",R({style:{marginTop:"3px"}},{children:(0,i.jsxs)(o.A,R({container:!0,spacing:.6},{children:[(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({variant:"outlined",disabled:!ae||S,color:"success",style:{width:"100%"},onClick:function(){return se(!1)}},{children:(0,i.jsx)(y.g0,{})}))})),(0,i.jsx)(o.A,R({size:6},{children:(0,i.jsx)(b.A,R({variant:"outlined",disabled:ae||S||de,color:"success",style:{width:"100%"},onClick:function(){return se(!0)}},{children:(0,i.jsx)(y.kp,{})}))}))]}))})),(0,i.jsx)("div",R({style:{marginTop:"auto"}},{children:(0,i.jsx)(b.A,R({onClick:function(){confirm("Are you sure you want to clear submitted timesheets?")&&Ze({})},style:{width:"100%"},startIcon:(0,i.jsx)(y.mW,{}),variant:"outlined",color:"warning"},{children:"Clear Submitted"}))}))]}))}));const $=B},51125:(e,t,n)=>{function i(e,t){void 0===t&&(t=new Date);var n=e/3600;return t.setTime(t.getTime()+60*n*60*60*60*1e3),t}function r(e){void 0===e&&(e=new Date);var t=6e4*(new Date).getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,-1).replace("T"," ").split(".")[0]}function a(e){if(!e)return!1;var t=new Date;return t.setHours(0,0,0,0),e.split(",").map((function(e){var t=new Date(e.trim());return t.setHours(0,0,0,0),t})).some((function(e){return e.getTime()===t.getTime()}))}n.d(t,{LY:()=>i,Or:()=>a,fU:()=>r})},76465:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(31601),r=n.n(i),a=n(76314),s=n.n(a)()(r());s.push([e.id,"input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}.numberBox{color:#1d575c;font-size:3rem;width:100%;text-align:center;background-color:rgba(0,0,0,0);border-width:0}.timeSeparator{color:#1d575c;font-size:3rem;margin-top:-4px}",""]);const o=s}}]);